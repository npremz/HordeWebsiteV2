--- 
interface Props {
	title?: string;
	stepsCount?: string;
	steps?: string[];
}

const {
	title = '<span>Nos 03</span><span>méthodes</span>',
	stepsCount = '03',
	steps = [
		'Eliminer les frictions pénalisantes',
		'Maximiser les conversions',
		"Soigner l'expérience utilisateur",
	],
} = Astro.props;

const svgs = [
	`<svg class="w-full lg:h-full" viewBox="0 0 494 412" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M411.667 0H329.333V247.2H411.667V0Z" fill="#222121"/>
		<path d="M247 0H164.667V247.2H247V0Z" fill="#222121"/>
		<path d="M82.3333 0H0V247.2H82.3333V0Z" fill="#222121"/>
		<path d="M494 247.2H411.667V412H494V247.2Z" fill="#222121"/>
		<path d="M329.333 247.2H247V412H329.333V247.2Z" fill="#222121"/>
		<path d="M164.667 247.2H82.3333V412H164.667V247.2Z" fill="#222121"/>
	</svg>`,
	`<svg class="w-full lg:h-full"  viewBox="0 0 494 412" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M164.667 164.8H329.333V247.2H164.667V164.8Z" fill="#222121"/>
		<path d="M494 247.2V412H411.667V329.6H329.333V247.2H494Z" fill="#222121"/>
		<path d="M0 164.8L1.43956e-05 0L82.3333 7.20364e-06L82.3333 82.4L164.667 82.4L164.667 164.8H0Z" fill="#222121"/>
		<path d="M164.667 247.2V329.6H82.3333V412H0V247.2H164.667Z" fill="#222121"/>
		<path d="M329.333 164.8V82.4H411.667V7.20364e-06L494 1.44073e-05V164.8H329.333Z" fill="#222121"/>
	</svg>`,
	`<svg class="w-full lg:h-full"  viewBox="0 0 494 412" fill="none" xmlns="http://www.w3.org/2000/svg">
		<path d="M0 0H82.3334V82.3999H0V0Z" fill="#222121"/>
		<path d="M0 164.8H82.3334V247.2H0V164.8Z" fill="#222121"/>
		<path d="M411.667 0H494V82.3999H411.667V0Z" fill="#222121"/>
		<path d="M411.667 164.799H494V247.199H411.667V164.799Z" fill="#222121"/>
		<path d="M164.667 329.599H329.333V411.999H164.667V329.599Z" fill="#222121"/>
		<path d="M411.667 329.6H494V412H411.667V329.6Z" fill="#222121"/>
		<path d="M0 329.6H82.3334V412H0V329.6Z" fill="#222121"/>
		<path d="M82.3253 82.4019H164.659V164.802H82.3253V82.4019Z" fill="#222121"/>
		<path d="M164.667 0H329.333V82.3998H164.667V0Z" fill="#222121"/>
		<path d="M329.333 247.201L411.667 247.199V329.6L329.333 329.599V247.201Z" fill="#222121"/>
		<path d="M329.333 82.3998L411.667 82.3999V164.799L329.333 164.8V82.3998Z" fill="#222121"/>
		<path d="M82.3253 247.201H164.659V329.6H82.3253V247.201Z" fill="#222121"/>
	</svg>`
]
---

<div class="relative flex-col-container justify-center items-center content-gap overflow-hidden">
	<div class="relative w-full gap-4">
		<span class="font-mono text-[14px] leading-none absolute top-0 right-0">(↓)</span>
		<h2 class="heading-display-sm text-[1.625rem] sm:text-[2.5rem] md:text-[4rem] lg:text-[6rem] xl:text-[7.5rem] flex flex-col *:block *:w-fit [&>*:first-child]:self-start [&>*:last-child]:self-end" set:html={title.replace(/\n/g, '<br>')}/>
		<span class="font-mono text-[14px] leading-none absolute bottom-0 left-0">({stepsCount})</span>
	</div>
	<div class="embla w-full border border-lines overflow-hidden select-none">
		<ul class="embla__container flex flex-row -ml-px scrollbar-hide">
			{steps.map((step, index) => (
				<li class:list={[
                    'embla__slide shrink-0 w-3/4 m-5 mr-0 pr-5 sm:my-16 sm:ml-10 sm:pr-10 gap-10 sm:gap-16 md:gap-10 lg:gap-16 lg:ml-16 lg:pr-16 xl:my-24 flex flex-col md:flex-row justify-between border-lines lg:flex-row', `${index == 2 ? '' : 'border-r'}`
                ]}> 
					<div class="flex flex-col gap-5 sm:flex-row sm:justify-between md:flex-col">
						<div class="font-display leading-none text-[2rem] sm:text-[4rem] not-only:shrink-0">
							/{String(index + 1).padStart(2, '0')}
						</div>
						<div class="uppercase text-sm font-mono text-justify leading-[1.7] sm:max-w-[200px]">
							{step}
						</div>
					</div>
					<div class="w-full lg:h-full max-h-215" set:html={svgs[index]}>
					</div>
				</li>
			))}
		</ul>
	</div>
</div>

<style>
	.scrollbar-hide::-webkit-scrollbar {
		display: none;
	}
	.scrollbar-hide {
		-ms-overflow-style: none;
		scrollbar-width: none;
	}

	.embla {
		cursor: grab;
	}
	.embla:active {
		cursor: grabbing;
	}
</style>

<script>
	import EmblaCarousel from 'embla-carousel';

	function initEmbla() {
		const emblaNode = document.querySelector('.embla') as HTMLElement;
		if (!emblaNode) return;

		const embla = EmblaCarousel(emblaNode, {
			dragFree: true,
			containScroll: 'trimSnaps',
		});

		// Cleanup on view transitions
		document.addEventListener('astro:before-swap', () => {
			embla.destroy();
		}, { once: true });
	}

	initEmbla();
	document.addEventListener('astro:after-swap', initEmbla);
</script>

