---
import Wrapped from "../ui/Wrapped.astro";

interface ServiceItem {
  title: string;
  subtitle: string;
  content: string;
  servicesList: string[];
}

const services: ServiceItem[] = [
  {
    title: "Audit &<br>performance",
    subtitle: "Comprendre avant d'agir",
    servicesList: [
      "Audit UX/UI",
      "Audit SEO technique",
      "Analyse Core Web Vitals",
      "Rapport de recommandations"
    ],
    content: "Vous voulez optimiser la conversion de votre site ? Nous réalisons un diagnostic complet (Vitesse de chargement, UX, SEO) pour identifier les points de friction qui bloquent vos utilisateurs. Une analyse factuelle pour des actions immédiates."
  },
  {
    title: "Optimisation<br>& refonte",
    subtitle: "Améliorer l'existant",
    servicesList: [
      "Optimisation des performances",
      "Refonte UI/UX",
      "Migration technique",
      "Responsive & mobile-first"
    ],
    content: "Pas besoin de tout jeter. Nous intervenons sur votre site existant pour booster ses performances (Core Web Vitals), moderniser son interface et le rendre ultra-rapide sur mobile."
  },
  {
    title: "Création \"from<br>scratch\" & MVP",
    subtitle: "Construire sur des bases solides",
    servicesList: [
		"Identité Visuelle",
		"Site vitrine",
		"Application web",
		"MVP & prototypage",
		"E-commerce"
    ],
    content: "Lancement de produit ou nouvelle identité ? Nous concevons des plateformes sur-mesure. Une architecture solide et pensée pour vos finances à long terme."
  }
];
---

<section class="py-24">
  <div class="">
    <h2 class="section-label mb-4 sm:mb-8 lg:mb-32">
      J'ai besoin de
    </h2>

    <div class="">
      {services.map((service, index) => (
        <div class="service-item border-b border-lines transition-colors duration-300">
          <button
            type="button"
            class:list={[
              "service-trigger w-full flex justify-between py-10 sm:py-16 lg:py-24 text-left cursor-pointer group",
              index % 2 === 1 && "flex-row-reverse"
            ]}
            aria-expanded="false"
            aria-controls={`service-content-${index}`}
          >
            <span class="font-display uppercase leading-none text-[1.625rem] sm:text-[2.5rem] md:text-[4rem] lg:text-[6rem] xl:text-[7.5rem] group-hover:opacity-70 transition-opacity" set:html={service.title} />
            <Wrapped class="service-icon h-fit shrink-0 font-mono transition-colors duration-300" aria-hidden="true">
              <span class="icon-plus">+</span>
              <span class="icon-minus hidden">-</span>
            </Wrapped>
          </button>
          <div
            id={`service-content-${index}`}
            class="service-content grid grid-rows-[0fr] transition-[grid-template-rows] duration-500 ease-out"
          >
            <div class="overflow-hidden">
              <div class="service-content-inner pb-10 sm:pb-16 lg:pb-24 flex flex-col gap-10 sm:gap-16 lg:gap-24 text-xl sm:text-[1.625rem] md:text-[2rem] opacity-0 transition-all duration-500 ease-out delay-0">
              <hr class="border-lines-dark">
			  <div class="flex flex-col gap-10 sm:gap-16 lg:flex-row lg:justify-between">
				<div class="md:max-w-150 ">
					<h3 class="section-label">Liste de services</h3>
					<ul class="mt-4 sm:mt-9 flex flex-col gap-4 sm:gap-5 sm:flex-row sm:shrink-0 sm:flex-wrap">
					{service.servicesList.map((item) => (
						<li>{item}</li>
					))}
					</ul>
				</div>
				<div class="md:max-w-150 flex flex-col gap-10 sm:gap-16">
					<div>
						<h3 class="section-label">
						{service.subtitle}
						</h3>
						<p class="mt-4 sm:mt-9 text-2xl leading-normal">
						{service.content}
						</p>
					</div>
              		<a href="https://calendly.com/ni-premont/30min" class="service-cta group relative overflow-hidden font-mono text-[1rem] leading-[0.6] uppercase py-6 px-5 w-fit border border-bg-light bg-transparent text-bg-light transition-colors duration-300 ease-in-out cursor-pointer">
						  <span class="absolute inset-0 bg-bg-light transform -translate-x-full group-hover:translate-x-0 transition-transform duration-400 ease-[cubic-bezier(0.25,0.46,0.45,0.94)]"></span>
						  <span class="relative z-10 group-hover:text-black transition-colors duration-300">Réserver un call</span>
						</a>
				</div>
			  </div>
              </div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>

<style>
  .service-trigger[aria-expanded="true"] .icon-plus {
    display: none;
  }
  .service-trigger[aria-expanded="true"] .icon-minus {
    display: inline;
  }

  /* Fond pleine largeur */
  .service-item {
    position: relative;
    margin-bottom: -1px;
  }

  .service-item::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 100vw;
    height: 100%;
    background-color: var(--color-black);
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease-out;
  }

  /* État ouvert */
  .service-item.is-open {
    color: var(--color-bg-light);
    transition: color 0.3s ease-out;
    z-index: 1;
  }

  .service-item.is-open::before {
    opacity: 1;
  }

  .service-item.is-open :global(.service-icon.wrapped) {
    color: var(--color-bg-light) !important;
  }

  /* État hover (desktop uniquement) */
  @media (hover: hover) {
    .service-item:hover {
      color: var(--color-bg-light);
      transition: color 0.3s ease-out;
      z-index: 1;
    }

    .service-item:hover::before {
      opacity: 1;
    }

    .service-item:hover :global(.service-icon.wrapped) {
      color: var(--color-bg-light) !important;
    }
  }

  .service-item.is-open .service-content {
    grid-template-rows: 1fr;
  }

  .service-item.is-open .service-content-inner {
    transform: translateY(0);
    opacity: 1;
    transition-delay: 150ms;
  }
</style>

<script>
  function initServiceAccordion() {
    const triggers = document.querySelectorAll('.service-trigger');

    triggers.forEach((trigger) => {
      trigger.addEventListener('click', () => {
        const isExpanded = trigger.getAttribute('aria-expanded') === 'true';
        const serviceItem = trigger.closest('.service-item');

        if (!serviceItem) return;

        // Fermer tous les autres
        triggers.forEach((otherTrigger) => {
          if (otherTrigger !== trigger) {
            otherTrigger.setAttribute('aria-expanded', 'false');
            const otherItem = otherTrigger.closest('.service-item');
            if (otherItem) {
              otherItem.classList.remove('is-open');
            }
          }
        });

        // Toggle l'élément actuel
        if (isExpanded) {
          trigger.setAttribute('aria-expanded', 'false');
          serviceItem.classList.remove('is-open');
        } else {
          trigger.setAttribute('aria-expanded', 'true');
          serviceItem.classList.add('is-open');
        }
      });
    });
  }

  // Init au chargement
  initServiceAccordion();

  // Re-init après les view transitions
  document.addEventListener('astro:after-swap', initServiceAccordion);
</script>